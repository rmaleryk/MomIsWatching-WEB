<!DOCTYPE html>
<html>
<head>
    <title>Mom is watching!</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 100%;
        }
    </style>

</head>
<body>

    <!-- MAP CANVAS -->
    <div id="map"></div>

    <script type="text/javascript">

		var map; // global map

		function initMap() {
		  var odessa = new google.maps.LatLng(46.447416, 30.749160);

		  map = new google.maps.Map(document.getElementById('map'), {
			center: odessa,
			zoom: 14
		  });

		}

    </script>

    <script type="text/javascript">
		var socket;

		if (typeof (WebSocket) !== 'undefined') {
			socket = new WebSocket("ws://momiswatching.azurewebsites.net/Subscriptions/MapSubscriptionHandler.ashx");
		} else {
			socket = new MozWebSocket("ws://momiswatching.azurewebsites.net/Subscriptions/MapSubscriptionHandler.ashx");
		}

		//socket.onopen = function() {
		//	alert("Соединение установлено.");
		//};

		//socket.onerror = function(error) {
		//	alert("Ошибка " + error.message);
		//};

		socket.onmessage = function (msg) {

			var myLatLng = { lat: parseFloat(msg.data.split(';')[0]), lng: parseFloat(msg.data.split(';')[1]) };

			var marker = new google.maps.Marker({
				position: myLatLng,
				map: map,
				title: 'Hello World!'
			  });

		};

		socket.onclose = function (event) {
			if (event.wasClean) {
				//alert('Соединение закрыто чисто');
			  } else {
				alert('[Error] Код: ' + event.code + ' причина: ' + event.reason);
			  }
		};

    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCdfmTZPJ5Qmcdhk-IGcIdT-88MG7ycT4k&signed_in=true&callback=initMap"></script>

</body>
</html>